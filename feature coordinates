#!/usr/bin/env python3

import glob
import pandas as pd
import numpy as np
import os

def get_filenames(folder):
    fnames_dir = glob.glob(folder + "/*")
    fnames = [os.path.split(fname_dir)[1] for fname_dir in fnames_dir]
    return fnames, fnames_dir

def main():
    input_folder = 'input'
    output_folder = 'output'
    os.makedirs(output_folder, exist_ok=True)

    fnames, fnames_dir = get_filenames(input_folder)

    for fname, fname_dir in zip(fnames, fnames_dir):
        input_file_coordinates = pd.read_csv(fname_dir, delimiter='\t', header=None).to_numpy()
        all_coords = []

        for coord in input_file_coordinates:
            try:
                coords = coord[0].split(":")[1].split("_")
                coords = list(map(int, coords))
                coords.sort()
                all_coords.append(coords)
            except:
                print("Error processing line:", coord)
                continue

        max_coord_length = max(max(all_coords)) + 1
        coords_one_hot = np.zeros(max_coord_length, dtype=np.uint8)

        for coord in all_coords:
            coords_one_hot[coord[0]:coord[1]+1] = 1

        total_sum_coords = sum(coords_one_hot)
        output_fname = os.path.join(output_folder, fname)
        with open(output_fname, "w") as f:
            f.write(f"{fname}\t{total_sum_coords}\n")

if __name__ == "__main__":
    main()

#!/bin/bash

# Usage: ./run_genic_calc.sh

mkdir -p output
python3 genic_region_calc.py

FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY genic_region_calc.py .
COPY run_genic_calc.sh .
RUN chmod +x run_genic_calc.sh

ENTRYPOINT ["./run_genic_calc.sh"]

